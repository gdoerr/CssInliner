{"name":"Cssinliner","tagline":"Css Inliner Tool for Html Email Templates","body":"# CssInliner\r\nCss Inliner Tool for Html Email Templates\r\n\r\nI was working on a customer project that required the sending of emails. I had worked with MailChimp previously and knew that\r\nthey had an email service, Mandrill, that supported templates and had recently added support for Handlebars to\r\nsupport merging of variable content into the template.\r\n\r\nWhile developing the templates, I was struck by the lack of available tooling to to simplify not only the process\r\nof creating the templates but also for maintaining them long term. In order to simplify my life and to make\r\nongoing maintenance easier, I decided to create my own solution.\r\n\r\nI identified a couple of key goals:\r\n* *Template Support* - rather than duplicating the markup for email in every single email, support the use of\r\ntemplates that contain the boilerplate markup\r\n* *HTML Import* - have the ability to import canned sections of html, preferably with parameters\r\n* *CSS Inlining* - make coding and maintenance easier by supporting css styling. The tool should handle\r\nthe process to change the css classes to inline styles. This should be selective and still allow css styles\r\nto be present in the final document for optimal rendering across different email renderers\r\n* *Merged Preview* - provide a preview of the processed emails merged with sample data\r\n* *Real time* - I didn't want to create an editor, I want to be able to use whatever editor I want. Real-time preview should\r\nprovide a rendered view of the final document that is automatically updated whenever it or any of it's dependencies are updated\r\n\r\n**CssInliner** provides the above functionality through a single jar. The tool can be run in either batch mode\r\nto process various templates into the final html email documents or interactively supporting live preview of the processed documents through a web browser.\r\n\r\n# Syntax\r\n### Templates\r\nUsing a syntax similar to Java Server Faces, you construct a template as a normal HTML document. This document would include your stylesheets along with any markup required to render the basic email layout.\r\n\r\nIn the template, mark areas where content will be inserted with `<ui:include section=\"section name\" />`. When generating the final document, this tag will be replaced by the content provided by a specific email document.\r\n\r\nThe `<head>` section of the final document is created by merging the head section of the template with the head section of the email document. In the case of element conflicts, elements from the email document take precedence over the template.\r\n\r\n```\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n    <head>\r\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\n        <link rel=\"stylesheet\" href=\"fragments/normal styles.css\"/>\r\n        <link rel=\"stylesheet\" href=\"fragments/inline styles.css\" ui:inline />\r\n    </head>\r\n    <body>\r\n        ... (body formatting)\r\n        <ui:include section=\"header\" />\r\n        ... (more formatting)\r\n        <ui:include section=\"content\" />\r\n        ... (final formatting)\r\n    </body>\r\n</html>\r\n```\r\nNotice from this sample the inclusion of two style sheets. The first one will be read and be included as css classes defined directly in the head of the final document. The second one will be read and have the resulting styles applied inline on the appropriate DOM elements. The stylesheet content will not be present in the final document. The stylesheets require no special formatting. I considered supporting advanced css formats like sass or less but given that all styles need to be inlined I believe the more verbose css style is more appropriate here.\r\n\r\n### Email documents\r\nEmail templates are also normal html document formatted to reference the template and to identify the content that is to be inserted into the template.\r\n\r\n```\r\n<html ui:template=\"fragments/template.tmpl\">\r\n    <head>\r\n        <title>My Email Title</title>\r\n    </head>\r\n    <body>\r\n        <ui:section name=\"header\">\r\n            <strong>My Email</strong> Title\r\n        </ui:section>\r\n\r\n        <ui:section name=\"content\">\r\n            <p>This is the body of my email.</p>\r\n        </ui:section>\r\n    </body>\r\n</html>\r\n```\r\n\r\nThis document, when processed, will render a complete HTML document ready for publishing to pretty much any email service that supports templates.\r\n\r\n### HTML Fragments\r\nOften times when constructing emails, you will use common markup segments either multiple times in the same document and/or across multiple documents. Also, in order to support proper rendering, it's nice to be able encapsulate certain content like buttons that require unique syntax to support clients such as Outlook. This is what **HTML Fragments** are for.\r\n\r\nBelow is a simple fragment that can be imported into a document. It defines three parameters:\r\n* `imageclass` - which is the class that should be applied to the img element\r\n* `imageurl` - which is the url that should be applied to the img elements `src` attribute\r\n* `content` - which is the content that should be included in the table element cell\r\n\r\n```\r\n<tr class=\"padding-top\">\r\n    <td class=\"image-container\">\r\n        <img width=\"64\" height=\"64\">\r\n            <parameter name=\"imageclass\" attr=\"class\" />\r\n            <parameter name=\"imageurl\" attr=\"src\" />\r\n        </img>\r\n    </td>\r\n    <td>\r\n        <parameter name=\"content\" />\r\n    </td>\r\n</tr>\r\n```\r\nNotice that we support both content parameters as well as parameters that apply an attribute to their enclosing element. After processing, the `parameter` tags are removed from the document.\r\n\r\nWe can now go back to our original email document and include this fragment.\r\n```\r\n    <ui:section name=\"content\">\r\n        <link rel=\"fragment.inc\">\r\n            <parameter name=\"imageclass\">avatar</parameter>\r\n            <parameter name=\"imageurl\">http://static.cdn.com/image.png</parameter>\r\n            <parameter name=\"content\">\r\n                <p>This is the body of my email.</p>\r\n            </parameter>\r\n        </link>\r\n    </ui:section>\r\n```\r\n### Mandrill Specific items\r\nWhile the code base is set up to support multiple email services, it only includes support for Mandrill at this time. Mandrill specific items:\r\n* `<meta name=\"mandrill-template\" content=\"My Email Name\" />` specify the name that Mandrill should use for the template\r\n* `<meta name=\"mandrill-labels\" content=\"PROGRAM1 OPTIONA\" />` specify the tags Mandrill should associate with the template\r\n* Extended Handlebars `if` support. This is not complete yet and not compatible with Mandrill's syntax - **work in progress**\r\n\r\n# Build Instructions\r\n\r\nCssInliner uses [Gradle](http://gradle.org) and [Webpack](https://webpack.github.io/) to build the application. Gradle handles the overall build\r\nand webpack handles the html/javascript side for Interactive mode.\r\n\r\nDependencies\r\n* Gradle 2.10 or later\r\n* Node / Npm\r\n\r\nBuild Steps\r\n* `gradle npmInstall` installs npm dependencies\r\n* `gradle build` builds a normal jar\r\n* `gradle fatjar` builds a jar with all dependencies\r\n\r\n\r\n# Future Plans\r\n* Prettier UI\r\n* Extract the Inliner code to a separate repository\r\n* Release my Gradle plugin for deploying templates to Mandrill\r\n * Publish the plugin to the Gradle plugin repo\r\n* Fully support Mandrill handlebars [unique syntax items](https://mandrill.zendesk.com/hc/en-us/articles/205582537-Using-Handlebars-for-Dynamic-Content)\r\n * There are some funky syntax in Mandrill Handlebars that doesn't even make past the initial handlebars parse. Any [Java Handlebars](https://github.com/jknack/handlebars.java) experts willing to lend a hand?\r\n* Add support for email platforms other than Mandrill\r\n* Set up on CI service like **Travis CI**\r\n* Publish artifacts to Maven Central\r\n* Publish to Mandrill from Preview and Command Line\r\n* Integrate with github for storage of template source\r\n\r\n# Acknowledgements\r\n* [Jsoup HTML Parser](https://github.com/jhy/jsoup)\r\n* [CSS Parser](http://cssparser.sourceforge.net/)\r\n* [Grizzly](https://grizzly.java.net/) Http Server / Websockets\r\n* [Jersey](https://jersey.java.net/) REST API for real time viewer\r\n* [Jackson](https://github.com/FasterXML/jackson) JSON formatting\r\n* [Java Handlebars](https://github.com/jknack/handlebars.java)\r\n* [Angular](https://angularjs.org/)\r\n* [Angular Material](https://material.angularjs.org/latest/)\r\n* [Moment](http://momentjs.com/)\r\n* [Angular Moment](https://github.com/urish/angular-moment)\r\n\r\nPlease contact me if you're interested in contributing.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}